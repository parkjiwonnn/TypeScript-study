# 7장 비동기 호출

## 7.1 API 요청

### (1) fetch로 API 요청하기

- API URL 수정사항이 발생했을 때 이미 컴포넌트 내부에 깊숙히 자리 잡은 비동기 호출 코드는 변경 요구에 취약함
- URL 변경 뿐만 아니라 ‘여러 서버에 API를 요청할 때 타임아웃 설정이 필요하다’ 또는 ‘모든 요청에 커스텀 헤더가 필요하다’ 같은 새로운 API 요청 정책이 추가될 때마다 계속해서 비동기 호출 코드를 수정해야 하는 번거로움이 발생함

```jsx
import React, { useEffect, useState } from "react";

const CartBadge: React.FC = () => {
  const [cartCount, setCartCount] = useState(0);

  useEffect(() => {
    fetch("https://api.baemin.com/cart")
      .then((response) => response.json())
      .then(({ cartItem }) => {
        setCartCount(cartItem.length);
      });
  }, []);

  return <>{/* cartCount 상태를 이용하여 컴포넌트 렌더링 */}</>;
};
```

### (2) 서비스 레이어로 분리하기

- 여러 API 요청 정책이 추가되어 코드가 변경될 수 있다는 것을 감안한다면, 비동기 호출 코드는 컴포넌트 영역에서 분리되어 다른 영역(서비스 레이어)에서 처리되어야 함
- fetch 함수를 호출하는 부분이 서비스 레이어로 이동하고, 컴포넌트는 서비스 레이어의 비동기 함수를 호출하여 그 결과를 받아와 렌더링하는 흐름이 됨
- 단순히 fetch 함수를 분리하는 것만으로는 API 요청 정책이 추가되는 것을 해결하기 어려움

### (3) Axios 활용하기

- fetch는 내장 라이브버리이기 때문에 따로 임포트하거나 설치할 필요 없이 사용할 수 있음
- 많은 기능을 사용하려면 직접 구현해서 사용해야하기 때문에 fetch 함수를 직접 쓰는 대신 Axios 라이브러리를 사용하면 편함

```jsx
const apiRequester: AxiosInstance = axios.create(defaultConfig);
const orderApiRequester: AxiosInstance = axios.create({
  baseURL: "https://api.baemin.or/",
  ...defaultConfig,
});
const orderCartApiRequester: AxiosInstance = axios.create({
  baseURL: "https://cart.baemin.order/",
  ...defaultConfig,
});
```
